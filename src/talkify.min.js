function Timer(){var a,b,c,d;this.pause=function(){window.clearTimeout(b),d-=new Date-c},this.resume=function(){c=new Date,window.clearTimeout(b),b=window.setTimeout(a,d)},this.cancel=function(){window.clearTimeout(b),a=null},this.start=function(c,e){a=c,d=e,b=window.setTimeout(a,d)}}function talkifyPlaybar(a){function q(a){a.classList.contains("talkify-hidden")||(a.className+=" talkify-hidden")}function r(a){a.className=a.className.replace("talkify-hidden","")}function s(){q(c),r(d)}function t(){q(d),r(c)}function u(a,b){a.classList.contains(b)||(a.className+=" "+b)}function v(a,b){a.className=a.className.replace(b,"")}function w(){var a=document.getElementById("htmlPlaybar");a&&a.parentNode.removeChild(a),n=document.createElement("section"),n.id="htmlPlaybar",n.className="talkify-audio-control",o=document.createElement("div"),o.className="talkify-audio-control-voice-wrapper",o.textContent="Speaking:",h=document.createElement("span"),k=document.createElement("i"),k.className="fa fa-cc talkify-clickable talkify-disabled",k.title="Toggle text highlighting (applied for the next paragraph)",o.appendChild(h),o.appendChild(k),l=document.createElement("div"),l.className="talkify-inline",i=document.createElement("span"),i.id="talkify-current-track-time",i.textContent="0:00",j=document.createElement("span"),j.id="talkify-track-time",j.textContent="0:00",l.appendChild(i),l.appendChild(document.createTextNode("/")),l.appendChild(j),g=document.createElement("progress"),g.setAttribute("value","0.0"),g.setAttribute("max","1.0");var p=document.createElement("i");p.className="fa fa-backward fa-2x talkify-clickable",c=document.createElement("i"),c.className="fa fa-play-circle fa-2x talkify-clickable",d=document.createElement("i"),d.className="fa fa-pause fa-2x talkify-clickable";var q=document.createElement("i");q.className="fa fa-forward fa-2x talkify-clickable",m=document.createElement("div"),m.className="talkify-wrapper talkify-inline";var r=document.createElement("i");r.className="fa fa-tachometer",e=document.createElement("input"),e.setAttribute("type","range"),e.setAttribute("value","5"),e.setAttribute("min","0"),e.setAttribute("max","10"),e.setAttribute("title","Adjust playback speed");var s=document.createElement("i");s.className="fa fa-volume-up",f=document.createElement("input"),f.setAttribute("type","range"),f.setAttribute("value","10"),f.setAttribute("min","0"),f.setAttribute("max","10"),e.setAttribute("title","Adjust playback volume"),n.appendChild(o),n.appendChild(l),n.appendChild(c),n.appendChild(d),n.appendChild(g),n.appendChild(m),m.appendChild(r),m.appendChild(e),m.appendChild(s),m.appendChild(f),b.parentElement.appendChild(n),t()}function x(){c.addEventListener("click",function(){p.onPlayClicked()}),d.addEventListener("click",function(){p.onPauseClicked()}),e.addEventListener("change",function(){p.onRateChanged(parseInt(this.value))}),f.addEventListener("change",function(a){p.onVolumeChanged(parseInt(this.value))}),k.addEventListener("click",function(a){k.classList.contains("talkify-disabled")?v(k,"talkify-disabled"):u(k,"talkify-disabled"),p.onTextHighlightingClicked()})}function y(){w(),x()}function z(a){a instanceof Node&&a.addEventListener("timeupdate",function(a){g.setAttribute("value",a.target.currentTime/a.target.duration);var b=document.getElementById("talkify-current-track-time"),c=document.getElementById("talkify-track-time"),d=Math.floor(a.target.currentTime/60),e=Math.round(a.target.currentTime)-60*d;b.textContent=d+":"+(e<10?"0"+e:e),d=Math.floor(a.target.duration/60),e=Math.round(a.target.duration)-60*d,c.textContent=d+":"+(e<10?"0"+e:e)},!0)}function A(){n.insertBefore(o,m),u(o,"talkify-inline")}function B(){n.insertBefore(o,l),v(o,"talkify-inline"),r(o)}function C(a){return a&&a.isTalkify}function D(a){r(g),B(),r(k),a&&(C(a)||(q(l),a.localService||(q(g),A(),q(k))))}function E(a){return a?C(a)?void(h.textContent=a.description):void(h.textContent=a.name):void(h.textContent="Automatic voice detection")}var c,d,e,f,g,h,i,j,k,l,m,n,o,b={parentElement:a||talkifyConfig.ui.audioControls.container||document.body},p={onPlayClicked:function(){},onPauseClicked:function(){},onVolumeChanged:function(){},onRateChanged:function(){},onTextHighlightingClicked:function(){}};return y(),{subscribeTo:function(a){return p.onPauseClicked=a.onPauseClicked||p.onPauseClicked,p.onPlayClicked=a.onPlayClicked||p.onPlayClicked,p.onRateChanged=a.onRateChanged||p.onRateChanged,p.onVolumeChanged=a.onVolumeChanged||p.onVolumeChanged,p.onTextHighlightingClicked=a.onTextHighlightingClicked||p.onTextHighlightingClicked,this},setRate:function(a){return e.setAttribute("value",a),this},setMaxRate:function(a){return e.setAttribute("max",a),this},setMinRate:function(a){return e.setAttribute("min",a),this},markAsPaused:t,markAsPlaying:s,setTextHighlight:function(a){return a?void v(k,"talkify-disabled"):void u(k,"talkify-disabled")},setProgress:function(a){g.setAttribute("value",a)},setVoice:function(a){return D(a),E(a),this},setAudioSource:function(a){z(a)}}}function TtsPlayer(){function c(){b.addEventListener("pause",d),b.addEventListener("play",e)}function d(){a.internalEvents.onPause(),a.wordHighlighter.pause()}function e(){if(a.internalEvents.onPlay(),a.currentContext.positions.length)if(a.audioSource.currentTime()>0)a.wordHighlighter.resume();else var b=setInterval(function(){a.audioSource.currentTime()>0&&(clearInterval(b),a.wordHighlighter.start(a.currentContext.item,a.currentContext.positions).then(function(b){a.events.onSentenceComplete(b)}))},20)}function f(){b=null;var c=document.getElementById("talkify-audio");c&&(c.outerHTML="");var d=document.createElement("source"),e=document.createElement("source");b=document.createElement("audio"),b.appendChild(d),b.appendChild(e),d.type="audio/mpeg",e.type="audio/wav",b.id="talkify-audio",b.controls=!talkifyConfig.ui.audioControls.enabled,b.autoplay=!0,document.body.appendChild(b);var f=b.cloneNode(!0);b.parentNode.replaceChild(f,b),b=f,a.mutateControls(function(){a.playbar.instance.subscribeTo({onPlayClicked:function(){a.play()},onPauseClicked:function(){a.audioElement.pause()},onVolumeChanged:function(b){a.audioElement.volume=b/10},onRateChanged:function(b){a.settings.rate=b}}).setRate(1).setMinRate(1).setMaxRate(3).setVoice(a.forcedVoice).setAudioSource(b)})}var b,a=this;this.currentContext={item:null,positions:[]},this.playbar={instance:null},this.audioSource={play:function(){b.play()},pause:function(){b.pause()},isPlaying:function(){return b.duration>0&&!b.paused},paused:function(){return b.paused},currentTime:function(){return b.currentTime},stop:function(){b.pause(),b.currentTime=0}},this.__proto__.__proto__=new BasePlayer(this.audioSource,this.playbar),f.apply(this),this.audioElement=b,c()}function talkifyPlaylist(){function d(){var a=document.createElement("audio");return"function"==typeof a.canPlayType&&(""!==a.canPlayType("audio/mpeg")||""!==a.canPlayType("audio/wav"))}function e(a,b){function g(){d.queue=[],b.withReferenceLanguage({Culture:"",Language:-1}),d.currentlyPlaying=null,d.refrenceText=""}function h(a,b){d.queue=d.queue.slice(0,a).concat(b).concat(d.queue.slice(a))}function i(a){d.queue=d.queue.concat(a)}function j(){for(var a=0;a<d.queue.length;a++){var b=d.queue[a];b.isPlaying=!1,b.isLoading=!1,b.element.removeClass("playing")}}function k(){for(var a=0;a<d.queue.length;a++)if(d.queue[a].isPlaying)return!0;return!1}function l(a){for(var b=0;b<d.queue.length;b++){var c=d.queue[b];if(c&&a.is(c.element))return!0}return!1}function m(a){var c=new promise.Promise;return!f&&a&&a.isPlaying?(b.paused()?b.play():b.pause(),c):(f=!1,j(),d.currentlyPlaying&&d.currentlyPlaying.element.html(d.currentlyPlaying.originalElement.html()),d.currentlyPlaying=a,c=b.playItem(a))}function n(a,b){function g(a,b){var c=b.length>0?$(b[0].outerHTML):$();return{text:a,preview:a.substr(0,40),element:b,originalElement:c,isPlaying:!1,isLoading:!1}}var c=1e3,d=[];if(a.length>c){var e=a.substr(0,c).lastIndexOf(".");e=e>-1?e:c;var f=a.substr(0,e);return d.push(g(f,b)),d=d.concat(n(a.substr(e,a.length-1),b))}return d.push(g(a,b)),d}function o(a){if(!a){if(0===d.queue.length)return;return void u()}s(a)}function p(){b.pause()}function q(a){a.element.css("cursor","pointer").addClass("talkify-highlight").unbind("click.talkify").bind("click.talkify",function(){o(a)})}function r(){g(),e.domElements&&0!==e.domElements.length||(e.domElements=c.extract(e.rootSelector));for(var a=0;a<e.domElements.length;a++){var b,f=$();"string"==typeof e.domElements[a]?b=e.domElements[a]:(f=$(e.domElements[a]),b=f.text().trim()),""!==b&&(i(n(b,f)),b.length>d.refrenceText.length&&(d.refrenceText=b))}if(e.useTextInteraction)for(var h=0;h<d.queue.length;h++){var j=d.queue[h];if(h>0){var k=j.element.is(d.queue[h-1].element);if(k)continue}q(j)}}function s(a){var b=function(a){return a?void e.events.onEnded():void v().then(b)};m(a).then(b)}function t(){var a=d.queue.indexOf(d.currentlyPlaying);return a===d.queue.length-1?null:d.queue[a+1]}function u(){return talkifyHttp.get("/api/Language?text="+d.refrenceText).then(function(a,c){return a?(d.referenceLanguage={Culture:"",Language:-1},b.withReferenceLanguage({Culture:"",Language:-1}),void s(d.queue[0])):(d.referenceLanguage=c,b.withReferenceLanguage(c),void s(d.queue[0]))})}function v(){var a=new promise.Promise,b=t();return b?m(b):(a.done("Completed"),a)}function w(a){var b=[],c=a.text();if(""===c.trim())return b;if(l(a))return b;for(var e=4,f=0;f<d.queue.length;f++){var g=d.queue[f],j=a[0].compareDocumentPosition(g.element[0])==e;if(j){var k=n(c,a);h(f,k),b=b.concat(k);break}var m=f===d.queue.length-1;if(m){var o=n(c,a);i(o),b=b.concat(o);break}}return b}function x(){d.currentlyPlaying&&(d.currentlyPlaying.isPlaying=!1,o(d.currentlyPlaying))}var c=new TalkifyTextextractor,d={queue:[],currentlyPlaying:null,refrenceText:"",referenceLanguage:{Culture:"",Language:-1}},e=a,f=!1;return r(),{getQueue:function(){return d.queue},play:o,pause:p,replayCurrent:x,insert:w,isPlaying:k,setPlayer:function(a){b=a,b.withReferenceLanguage(d.referenceLanguage),f=!0,x()}}}var a={useGui:!1,useTextInteraction:!1,domElements:[],rootSelector:"body",events:{onEnded:null}},b=JSON.parse(JSON.stringify(a)),c=null;return{begin:function(){return b=JSON.parse(JSON.stringify(a)),c=null,{withTextInteraction:function(){return b.useTextInteraction=!0,this},withTalkifyUi:function(){return b.useGui=!0,this},withRootSelector:function(a){return b.rootSelector=a,this},withElements:function(a){return b.domElements=a,this},usingPlayer:function(a){return c=a,this},subscribeTo:function(a){return b.events.onEnded=a.onEnded||function(){},this},build:function(){if(!d())throw new Error("Not supported. The browser needs to support mp3 or wav HTML5 Audio.");if(!c)throw new Error("A player must be provided. Please use the 'usingPlayer' method to provide one.");return b.events.onEnded=b.events.onEnded||function(){},new e(b,c)}}}}}var TalkifyTextextractor=function(){function d(b){for(var c=[],d=0;d<b.length;d++)b[d].is(":hidden")||c.push(a[d]);return c}function e(a){return a.replace(/(\r\n|\n|\r)/gm,"").trim()}function f(a){return!!a&&("#text"===a.nodeName&&e(a.textContent).length>=10)}function g(a){if(a.siblings().length>=1)return!0;var b=a[0].previousSibling;if(f(b))return!0;var c=a[0].nextSibling;return!!f(c)}function h(a){var c="#text"===a.nodeName,d=e(a.textContent).length;return c&&d>=5||$(a).is(b)}function i(a,b){for(var c=[],d=b;d<a.length&&h(a[d]);d++)c.push($(a[d]));return c}function j(a){for(var b=$('<span class="superbar"></span>'),c=0;c<a.length;c++)b.append(a[c].clone());return b}function k(a){return $('<span class="foobar"></span').append(a.textContent)}function l(a){var b=k(a);return $(a).replaceWith(b),b}function m(b){if(b&&0!==b.length)for(var d=0;d<b.length;d++){var h=$(b[d]);if(h.is("p, h1, h2, h3, h4, h5, h6"))a.push(h);else if(h.is(c)){var k=h.find("h1, h2, h3, h4");k.each(function(){a.push($(this))})}else if(!h.is("a")||g(h)){var n=i(b,d);if(n.length>1){var o=j(n),p=e(o.text()).length>=20;if(p){$(b[d]).replaceWith(o);for(var q=0;q<n.length;q++)n[q].remove();a.push(o);continue}}var r=b[d];f(r)&&a.push(l(r)),m(r.childNodes)}}}function n(b){a=[];for(var e=$(b+" > *:not("+c+")"),f=new Date,g=0;g<e.length;g++){var h=$(e[g]);h.is("p, h1, h2, h3, h4, h5, h6")?a.push(h):m(e[g].childNodes)}var i=d(a);return console.log(new Date-f),i}var a=[],b=["a","span","b","big","i","small","tt","abbr","acronym","cite","code","dfn","em","kbd","strong","samp","var","a","bdo","q","sub","sup","label"].join(),c=["img","map","object","script","button","input","select","textarea","br","style","code","nav","#nav","#navigation",".nav",".navigation","footer"].join();return{extract:n}},TalkifyWordHighlighter=function(){function c(a,c,d){f(),b=a;var e=a.element.text().trim();return 0===d?void a.element.html('<span class="talkify-word-highlight">'+e.substring(0,c.length)+"</span> "+e.substring(c.length+1)):void a.element.html(e.substring(0,d)+'<span class="talkify-word-highlight">'+e.substring(d,d+c.length)+"</span>"+e.substring(d-1+c.length+1))}function d(b,d){var e=new promise.Promise;if(a.cancel(),f(),!d.length)return e.done(b);var g=0,h=function(){if(c(b,d[g].Word,d[g].CharPosition),g++,g>=d.length)return a.cancel(),void window.setTimeout(function(){b.element.html(b.originalElement.html()),e.done(b)},1e3);var f=d[g].Position-d[g-1].Position+0;a.cancel(),a.start(h,f)};return h(),e}function e(){a.cancel(),f()}function f(){b&&b.element.html(b.originalElement.html())}var a=new Timer,b=null;return{pause:a.pause,resume:a.resume,start:d,highlight:c,cancel:e}},talkifyHttp=function(){var b=function(a){var b=new promise.Promise;return promise.get(window.talkifyConfig.host+a).then(function(a,c){try{var d=JSON.parse(c);b.done(a,d)}catch(a){b.done(a,c)}}),b};return{get:b}}();talkifyConfig={host:"",ui:{audioControls:{enabled:!1,container:document.body}}};var Html5Player=function(){this.isStopped=!1,this.volume=1,this.currentContext={item:null,endedCallback:function(){},utterances:[],currentUtterance:null};var a=this;this.playbar={instance:null},this.audioSource={play:function(){return window.speechSynthesis.paused?void window.speechSynthesis.resume():void(a.currentContext.item&&a.playCurrentContext())},pause:function(){window.speechSynthesis.pause(),a.internalEvents.onPause()},ended:function(){return!window.speechSynthesis.speaking},isPlaying:function(){return window.speechSynthesis.speaking},paused:function(){return!window.speechSynthesis.speaking},currentTime:function(){return 0},cancel:function(b){b?a.stop():window.speechSynthesis.cancel()},stop:function(){a.stop()}},this.__proto__.__proto__=new BasePlayer(this.audioSource,this.playbar),a.mutateControls(function(b){b.subscribeTo({onPlayClicked:function(){a.audioSource.play()},onPauseClicked:function(){a.pause()},onVolumeChanged:function(b){a.volume=b/10},onRateChanged:function(b){a.settings.rate=b/5}}).setVoice(this.forcedVoice)})};Html5Player.prototype.extractWords=function(a,b){var c=new RegExp(/[&\$\-|]|([("\-&])*(\b[^\s]+[.:,"-)!&?]*)/g);if(b){if(b.indexOf("zh-")>-1)return a.split("，");if(b.indexOf("ko-")>-1)return a.split(".")}for(var e,d=[];null!==(e=c.exec(a));)e.index===c.lastIndex&&c.lastIndex++,d.push(e[0]);return d},Html5Player.prototype.getVoice=function(){var a=new promise.Promise,b=this;if(this.forcedVoice)return a.done(this.forcedVoice),a;if(window.speechSynthesis.getVoices().length){var c=window.speechSynthesis.getVoices();return a.done(b.selectVoiceToPlay(c)),a}return window.speechSynthesis.onvoiceschanged=function(){var c=window.speechSynthesis.getVoices();a.done(b.selectVoiceToPlay(c))},a},Html5Player.prototype.selectVoiceToPlay=function(a){for(var b=[],c=null,d=this.settings.lockedLanguage||this.settings.referenceLanguage.Culture,e=0;e<a.length;e++)a[e].lang===d&&(b.push(a[e]),c=a[e]);for(var f=0;f<b.length;f++)if(b[f].localService){c=b[f];break}return!c&&b.length&&(c=b[0]),!c&&a.length&&(c=a[0]),c},Html5Player.prototype.chunckText=function(a){var b=this.settings.lockedLanguage||this.settings.referenceLanguage.Culture,c=b.indexOf("zh-")>-1?70:b.indexOf("ko-")>-1?130:200,d=[],e=a.split(/(\?|\.|。)+/g),f="",g=this;return e.forEach(function(a){if(""===a||"."===a||"。"===a||"?"===a)return void(f&&(f+=a));if(f&&f.length+a.length>c&&(d.push(f),f=""),a.length>c){var e=g.extractWords(a,b);return e.forEach(function(a){f.length+a.length>c&&(d.push(f),f=""),f+=a.trim()+" "}),void(f.trim()&&(d.push(f.trim()+"."),f=""))}f+=a}),d.push(f),d},Html5Player.prototype.playAudio=function(a,b){this.currentContext.endedCallback=b,this.currentContext.item=a,this.currentContext.utterances=[],this.currentContext.currentUtterance=null;var c=this;return c.playCurrentContext()},Html5Player.prototype.playCurrentContext=function(){var a=this.currentContext.item,b=this.currentContext.endedCallback,c=this.chunckText(a.text),d=this;d.currentContext.utterances=[],d.isStopped=!1,c.forEach(function(a){var b=new window.SpeechSynthesisUtterance;b.text=a,b.lang=d.settings.lockedLanguage||d.settings.referenceLanguage.Culture,b.rate=d.settings.rate,b.volume=d.volume,d.currentContext.utterances.push(b)});var e=new promise.Promise,f=0,g=0,h=this.extractWords(a.text);return d.currentContext.utterances[d.currentContext.utterances.length-1].onend=function(c){d.events.onSentenceComplete(a),d.currentContext.currentUtterance&&d.currentContext.currentUtterance.text===c.currentTarget.text&&b&&!d.isStopped&&b()},d.currentContext.utterances.forEach(function(b,c){0===c?b.onstart=function(a){d.currentContext.currentUtterance=a.utterance,e.done(),d.internalEvents.onPlay()}:b.onstart=function(a){d.currentContext.currentUtterance=a.utterance},b.onpause=function(){d.internalEvents.onPause()},b.onresume=function(){},b.onboundary=function(c){if("word"===c.name&&h[f]&&(d.mutateControls(function(a){a.setProgress((f+1)/h.length)}),d.settings.useTextHighlight&&b.voice.localService)){for(var e=0,i=0;i<f;i++)e+=h[i].length+1;var j=g+1===c.charIndex;if(j)return void(g=c.charIndex);d.wordHighlighter.highlight(a,h[f],e),f++,g=c.charIndex}},d.getVoice().then(function(c){h.length&&d.settings.useTextHighlight&&c.localService&&d.wordHighlighter.highlight(a,h[0],0),b.voice=c,console.log(b),window.speechSynthesis.cancel(),d.mutateControls(function(a){a.setVoice(c)}),window.setTimeout(function(){window.speechSynthesis.speak(b)},100)})}),e},Html5Player.prototype.stop=function(){this.isStopped=!0,this.internalEvents.onPause(),window.speechSynthesis.cancel(),this.currentContext.utterances.indexOf(this.currentContext.currentUtterance)<this.currentContext.utterances.length-1&&(console.log("Not the last, finishing anyway..."),this.events.onSentenceComplete(this.currentContext.item))},Html5Player.prototype.setVolume=function(a){return this.volume=a,this},TtsPlayer.prototype.getPositions=function(){var a=this,b=new promise.Promise;return talkifyHttp.get("/api/Speak/GetPositions?id="+a.id).then(function(a,c){b.done(null,c)}),b},TtsPlayer.prototype.playAudio=function(a,b){var c=this;c.currentContext.item=a,c.currentContext.positions=[];var d=new promise.Promise,e=this.audioElement.getElementsByTagName("source"),f=encodeURIComponent(a.text.replace(/\n/g," ")),g=this.forcedVoice?this.forcedVoice.name:"";return e[0].src=talkifyConfig.host+"/api/Speak?format=mp3&text="+f+"&refLang="+this.settings.referenceLanguage.Language+"&id="+this.id+"&voice="+g+"&rate="+this.settings.rate,e[1].src=talkifyConfig.host+"/api/Speak?format=wav&text="+f+"&refLang="+this.settings.referenceLanguage.Language+"&id="+this.id+"&voice="+g+"&rate="+this.settings.rate,this.audioElement.load(),$(this.audioElement).unbind("loadeddata").bind("loadeddata",function(){return c.audioSource.pause(),c.settings.useTextHighlight?void c.getPositions().then(function(a,b){c.currentContext.positions=b||[],d.done(),c.audioSource.play()}):(d.done(),void c.audioSource.play())}).unbind("ended.justForUniqueness").bind("ended.justForUniqueness",b||function(){}),d};var BasePlayer=function(a,b){this.audioSource=a,this.wordHighlighter=new TalkifyWordHighlighter,this.id=this.generateGuid();var c=this;this.settings={useTextHighlight:!1,referenceLanguage:{Culture:"",Language:-1},lockedLanguage:null,rate:1,useControls:!1},this.playbar=b,this.forcedVoice=null,this.events={onBeforeItemPlaying:function(){},onItemLoaded:function(){},onSentenceComplete:function(){},onPause:function(){},onPlay:function(){},onResume:function(){}},this.internalEvents={onPause:function(){c.mutateControls(function(a){a.markAsPaused()}),!c.audioSource.ended&&c.audioSource.currentTime()>0&&c.events.onPause()},onPlay:function(){c.mutateControls(function(a){a.markAsPlaying()}),c.audioSource.currentTime()>0?c.events.onResume():c.events.onPlay()},onStop:function(){c.mutateControls(function(a){a.markAsPaused()})}},this.mutateControls=function(a){this.playbar.instance&&a(this.playbar.instance)},talkifyConfig.ui.audioControls.enabled&&(this.playbar.instance=talkifyPlaybar().subscribeTo({onTextHighlightingClicked:function(){c.settings.useTextHighlight=!c.settings.useTextHighlight}}))};BasePlayer.prototype.withReferenceLanguage=function(a){return this.settings.referenceLanguage=a,this},BasePlayer.prototype.withTextHighlighting=function(){return this.settings.useTextHighlight=!0,this.mutateControls(function(a){a.setTextHighlight(!0)}),this},BasePlayer.prototype.setRate=function(a){return this.settings.rate=a,this},BasePlayer.prototype.subscribeTo=function(a){return this.events.onBeforeItemPlaying=a.onBeforeItemPlaying||function(){},this.events.onSentenceComplete=a.onItemFinished||function(){},this.events.onPause=a.onPause||function(){},this.events.onPlay=a.onPlay||function(){},this.events.onResume=a.onResume||function(){},this.events.onItemLoaded=a.onItemLoaded||function(){},this},BasePlayer.prototype.generateGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},BasePlayer.prototype.playItem=function(a){var b=new promise.Promise;if(a&&a.isPlaying)return this.audioSource.paused()?this.audioSource.play():this.audioSource.pause(),b;this.events.onBeforeItemPlaying(a);var c=this;return a.isLoading=!0,a.isPlaying=!0,a.element.addClass("playing"),this.playAudio(a,function(){a.isPlaying=!1,b.done()}).then(function(){a.isLoading=!1,c.events.onItemLoaded()}),b},BasePlayer.prototype.createItems=function(a,b){function f(a,b){var c=b.length>0?$(b[0].outerHTML):$();return{text:a,preview:a.substr(0,40),element:b,originalElement:c,isPlaying:!1,isLoading:!1}}var c=1e3,d=[];if(a.length>c){var e=a.substr(0,c);return d.push(f(e,b)),d=d.concat(this.createItems(a.substr(c,a.length-1),b))}return d.push(f(a,b)),d},BasePlayer.prototype.playText=function(a){var b=this.createItems(a,$()),c=0,d=function(){c++,c>=b.length||this.playItem(b[c]).then(d)};this.playItem(b[c]).then(d)},BasePlayer.prototype.paused=function(){return this.audioSource.paused()},BasePlayer.prototype.isPlaying=function(){return this.audioSource.isPlaying()},BasePlayer.prototype.play=function(){this.audioSource.play()},BasePlayer.prototype.pause=function(){this.audioSource.pause();var a=this;!a.audioSource.paused()&&a.audioSource.cancel&&a.audioSource.cancel(!0)},BasePlayer.prototype.dispose=function(){this.wordHighlighter.cancel(),this.audioSource.stop(),this.internalEvents.onStop()},BasePlayer.prototype.forceLanguage=function(a){return this.settings.lockedLanguage=a,this},BasePlayer.prototype.forceVoice=function(a){return this.forcedVoice=a,this.mutateControls(function(b){b.setVoice(a)}),this};